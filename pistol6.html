<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pistolskytte Logg</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    margin: 0;
    padding: 20px;
    text-align: center;
}

.page { display: none; max-width: 600px; margin: 0 auto; }
.show { display: block !important; }

/* STARTMENY KNAPPAR */
.big-btn {
    width: 100%;
    padding: 22px;
    font-size: 22px;
    margin-bottom: 15px;
    border: none;
    border-radius: 18px;
    color: white;
    font-weight: bold;
    cursor: pointer;
}

.prec-btn { background: #1e88e5; }
.snabb-btn { background: #43a047; }
.log-btn { background: #512da8; }
.export-btn { background: #4a148c; }

/* EXPORT UNDERMENY */
.export-sub-btn {
    width: 100%;
    padding: 18px;
    background: #6a1b9a;
    border: none;
    color: white;
    font-size: 18px;
    border-radius: 12px;
    margin-bottom: 10px;
}

/* INMATNING */
.shot-display {
    font-size: 26px;
    font-weight: bold;
    padding: 16px;
    background: white;
    border-radius: 12px;
    margin-bottom: 20px;
}

.grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
}

.num-btn {
    padding: 22px 0;
    font-size: 26px;
    font-weight: bold;
    background: #0d47a1;
    color: white;
    border-radius: 16px;
    border: none;
    cursor: pointer;
}

/* SMÃ… KNAPPAR */
.small-btn {
    padding: 16px;
    font-size: 16px;
    border-radius: 12px;
    border: none;
    color: white;
    margin: 10px;
    width: 45%;
    cursor: pointer;
}

.undo { background: #ffb300; color: black; }
.clear { background: #c62828; }
.save { background: #1b5e20; width: 100%; }
.back { background: #b71c1c; width: 100%; margin-top: 10px; }

/* LOGGBOK */
.log-card {
    background: white;
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 12px;
    text-align: left;
}

.log-del {
    background: #c62828;
    border: none;
    color: white;
    padding: 8px 12px;
    border-radius: 8px;
    float: right;
}
</style>
</head>

<body>

<!-- STARTSIDAN -->
<div id="start" class="page show">
<h1>Pistolskytte Logg</h1>

<button class="big-btn prec-btn" onclick="startSeries('.22 â€“ Precision',5)">.22 â€“ Precision</button>
<button class="big-btn prec-btn" onclick="startSeries('9mm â€“ Precision',5)">9mm â€“ Precision</button>

<button class="big-btn snabb-btn" onclick="startSeries('.22 â€“ Snabbserie',6)">.22 â€“ Snabbserie</button>
<button class="big-btn snabb-btn" onclick="startSeries('9mm â€“ Snabbserie',6)">9mm â€“ Snabbserie</button>

<button class="big-btn log-btn" onclick="openLogbook()">ðŸ“’ Loggbok</button>
<button class="big-btn export-btn" onclick="toggleExport()">ðŸ“¤ Exportera</button>

<div id="exportMenu" style="display:none;">
    <button class="export-sub-btn" onclick="exportCSV()">ðŸ“„ Exportera som CSV</button>
</div>
</div>

<!-- INMATNINGSSIDAN -->
<div id="series" class="page">
<h2 id="seriesTitle"></h2>

<div class="shot-display" id="shotList">-</div>

<div class="grid">
    <button class="num-btn">X</button>
    <button class="num-btn">10</button>
    <button class="num-btn">9</button>
    <button class="num-btn">8</button>
    <button class="num-btn">7</button>
    <button class="num-btn">6</button>
    <button class="num-btn">5</button>
    <button class="num-btn">4</button>
    <button class="num-btn">3</button>
    <button class="num-btn">2</button>
    <button class="num-btn">1</button>
    <button class="num-btn">0</button>
</div>

<!-- PLATSVAL -->
<div style="margin-top:20px;">
    <label style="font-size:18px;font-weight:bold;">Plats:</label>
    <select id="plats" onchange="checkCustomPlats()" 
            style="padding:10px;font-size:18px;border-radius:8px;margin-left:10px;">
        <option value="Berget">Berget</option>
        <option value="Grimsta">Grimsta</option>
        <option value="LÃ¶vsta">LÃ¶vsta</option>
        <option value="Annan">Annanâ€¦</option>
    </select>
</div>

<div id="customPlatsDiv" style="display:none; margin-top:10px;">
    <input id="customPlats" type="text" placeholder="Skriv plats..." 
           style="padding:10px;font-size:18px;width:70%;border-radius:8px;">
</div>

<!-- MILJÃ– -->
<div style="margin-top:20px;">
    <label style="font-size:18px;font-weight:bold;">MiljÃ¶:</label>
    <select id="miljo" style="padding:10px;font-size:18px;border-radius:8px;margin-left:10px;">
        <option value="Utomhus">Utomhus</option>
        <option value="Inomhus">Inomhus</option>
    </select>
</div>

<button class="small-btn undo" onclick="undo()">âŸ² Ã…ngra</button>
<button class="small-btn clear" onclick="clearAll()">ðŸ—‘ Rensa</button>
<button class="small-btn save" onclick="saveSeries()">ðŸ’¾ Spara serie</button>
<button class="small-btn back" onclick="goHome()">â¬… Tillbaka</button>
</div>

<!-- LOGGBOK -->
<div id="log" class="page">
<h2>Loggbok</h2>
<div id="logList"></div>
<button class="small-btn back" onclick="goHome()">â¬… Tillbaka</button>
</div>

<script>
let shots = [];
let maxShots = 5;
let currentType = "";
let logData = JSON.parse(localStorage.getItem("logData") || "[]");

function showPage(id){
    document.querySelectorAll(".page").forEach(p => p.classList.remove("show"));
    document.getElementById(id).classList.add("show");
}

function startSeries(type, count){
    shots = [];
    maxShots = count;
    currentType = type;
    document.getElementById("seriesTitle").innerText = type;
    document.getElementById("shotList").innerText = "-";
    showPage("series");
}

document.querySelectorAll(".num-btn").forEach(btn => {
    btn.onclick = () => {
        if(shots.length >= maxShots) return;
        shots.push(btn.innerText);
        updateShots();
    };
});

function updateShots(){
    document.getElementById("shotList").innerText = shots.join(" â€“ ");
}

function undo(){
    shots.pop();
    updateShots();
}

function clearAll(){
    shots = [];
    updateShots();
}

function checkCustomPlats() {
    let plats = document.getElementById("plats").value;
    document.getElementById("customPlatsDiv").style.display = 
        (plats === "Annan") ? "block" : "none";
}

function saveSeries(){
    if(shots.length !== maxShots){
        alert("Du mÃ¥ste fylla i " + maxShots + " skott!");
        return;
    }

    let plats = document.getElementById("plats").value;
    if (plats === "Annan") {
        plats = document.getElementById("customPlats").value || "Odefinierad plats";
    }

    logData.push({
        id: Date.now(),
        date: new Date().toLocaleDateString(),
        type: currentType,
        plats: plats,
        miljo: document.getElementById("miljo").value,
        shots: [...shots],
        score: shots.reduce((a,b)=>a + (b==="X"?10:parseInt(b)), 0)
    });

    localStorage.setItem("logData", JSON.stringify(logData));
    goHome();
}

function openLogbook(){
    let c = document.getElementById("logList");
    c.innerHTML = "";

    logData.forEach(e => {
        let div = document.createElement("div");
        div.className = "log-card";
        div.innerHTML = `
            <b>${e.date}</b><br>
            Kaliber: <b>${e.type.split(" â€“ ")[0]}</b><br>
            Gren: <b>${e.type.split(" â€“ ")[1]}</b><br>
            Plats: <b>${e.plats}</b><br>
            MiljÃ¶: <b>${e.miljo}</b><br>
            Skott: ${e.shots.join(" â€“ ")}<br>
            PoÃ¤ng: <b>${e.score}</b>
            <button class="log-del" onclick="del(${e.id})">Ta bort</button>
        `;
        c.appendChild(div);
    });

    showPage("log");
}

function del(id){
    logData = logData.filter(e => e.id !== id);
    localStorage.setItem("logData", JSON.stringify(logData));
    openLogbook();
}

function goHome(){
    showPage("start");
}

function toggleExport(){
    let m = document.getElementById("exportMenu");
    m.style.display = (m.style.display === "none" ? "block" : "none");
}

function exportCSV() {
    if (logData.length === 0) {
        alert("Loggboken Ã¤r tom!");
        return;
    }

    let csv = "Datum;Kaliber;Gren;Plats;MiljÃ¶;Skott;PoÃ¤ng\n";

    logData.forEach(e => {
        let kaliber = e.type.split(" â€“ ")[0];
        let gren = e.type.split(" â€“ ")[1];

        csv += `${e.date};${kaliber};${gren};${e.plats};${e.miljo};"${e.shots.join(" ")}";${e.score}\n`;
    });

    let blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    let url = URL.createObjectURL(blob);

    let a = document.createElement("a");
    a.href = url;
    a.download = "pistol_loggbok.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}
</script>

</body>
</html>
